# 媒体查询：语法与最佳实践

媒体查询是响应式设计的技术核心。它赋予了 CSS 根据设备特性（如视口宽度、屏幕方向、用户偏好等）来条件性地应用样式的能力。掌握媒体查询的语法和最佳实践，是构建高质量响应式网站的关键。

## 1. 语法详解

媒体查询由一个可选的媒体类型和任意数量的媒体特性表达式组成。

### a. 基本结构
`css
@media [media-type] and (media-feature-expression) {
  /* CSS 规则... */
}
`
- **@media**: 媒体查询的起始关键字。
- **media-type (可选)**: 指定查询应用到的设备类别。
  - ll: 适用于所有设备（默认值）。
  - print: 适用于打印预览模式或打印机。
  - screen: 适用于彩色计算机屏幕。
  - speech: 适用于屏幕阅读器等语音合成设备。
  在现代 Web 开发中，由于主要目标是屏幕，media-type 通常被省略，或显式写作 screen。

- **media-feature-expression**: 媒体特性表达式，是应用样式的具体条件，必须用括号括起来。

### b. 媒体特性 (Media Features)

这是媒体查询中最常用的部分，用于检测浏览器的具体特性。

**视口与尺寸相关的特性 (最常用):**
- **width**: 视口的宽度。
- **height**: 视口的高度。
- **min-width**: 当视口宽度 **大于或等于** 指定值时生效。
- **max-width**: 当视口宽度 **小于或等于** 指定值时生效。
- **orientation**: 视口的方向。
  - portrait: 竖屏（高度大于或等于宽度）。
  - landscape: 横屏（宽度大于高度）。
- **spect-ratio**: 视口的宽高比，如 16/9。
- **min-aspect-ratio**, **max-aspect-ratio**: 最小/最大宽高比。

**用户偏好相关的特性 (越来越重要):**
- **prefers-color-scheme**: 检测用户系统的颜色主题偏好。
  - light: 浅色模式。
  - dark: 暗色模式。
- **prefers-reduced-motion**: 检测用户是否希望减少不必要的动画效果。
  - 
o-preference: 用户没有设置偏好。
  - educe: 用户希望减少动画。
- **prefers-contrast**: 检测用户是否要求系统以更高或更低的对比度显示内容。

**设备能力相关的特性:**
- **hover**: 检测用户的输入机制是否支持悬停。
  - hover: 支持悬停（如鼠标）。
  - 
one: 不支持悬停（如触摸屏）。
- **pointer**: 检测指针的精确度。
  - ine: 精确指针（如鼠标、触控笔）。
  - coarse: 不精确指针（如手指）。
- **ny-hover**, **ny-pointer**: 检测任何可用的输入机制是否支持悬停或具有精确指针。

### c. 逻辑操作符

- **nd**: 用于组合多个媒体特性，所有特性都必须为真，查询才为真。
- **
ot**: 用于否定一个媒体查询，使其在条件为假时生效。必须放在查询的最前面。
- **, (逗号)**: 相当于逻辑上的 OR。用于将多个媒体查询组合在一起，只要其中任何一个为真，样式就会被应用。

**示例:**
`css
/* 当视口宽度在 600px 和 1000px 之间时 */
@media screen and (min-width: 600px) and (max-width: 1000px) { ... }

/* 当设备不是打印机时 */
@media not print { ... }

/* 当视口高度大于600px，或者屏幕方向为横屏时 */
@media (min-height: 600px), (orientation: landscape) { ... }
`

## 2. 最佳实践：移动优先 (Mobile First)

移动优先是一种编写响应式 CSS 的策略，它已经成为现代 Web 开发的黄金标准。

### a. 核心思想
1.  **编写基础样式**: 首先，为最小的屏幕（即移动设备）编写核心的、通用的 CSS。这些样式通常比较简单，采用单列布局，确保核心内容的可访问性。
2.  **渐进增强**: 然后，使用带有 min-width 的媒体查询，为更大的屏幕（平板、桌面）逐步添加更复杂的样式。这些样式可能会引入多列布局、显示更多内容、或者增加仅在大屏上有意义的交互效果。

### b. 代码示例
`css
/* --- 1. 移动优先的基础样式 --- */
.main-navigation {
  text-align: center; /* 移动端菜单居中 */
}
.main-navigation ul {
  list-style: none;
  padding: 0;
}
.main-navigation li {
  display: block; /* 每个菜单项占一行 */
  margin-bottom: 10px;
}
.sidebar {
  display: none; /* 移动端默认不显示侧边栏 */
}

/* --- 2. 渐进增强：平板及以上 --- */
@media (min-width: 768px) {
  .main-navigation li {
    display: inline-block; /* 变为水平排列 */
    margin-right: 20px;
    margin-bottom: 0;
  }
  .sidebar {
    display: block; /* 开始显示侧边栏 */
    float: right;
    width: 30%;
  }
  .main-content {
    float: left;
    width: 65%;
  }
}
`

### c. 为什么移动优先更好？
- **性能**: 移动设备作为网络条件和处理能力通常较差的一方，只需下载和解析最核心、最简单的 CSS。桌面端用户通常有更好的网络和性能，可以轻松承担加载额外样式的开销。
- **用户体验**: 强制开发者优先思考在小屏幕上哪些内容和功能是最重要的，这有助于做出更好的产品决策。
- **代码维护**: CSS 以一种向上扩展的方式编写，逻辑更清晰，更容易维护和添加新的断点。相比之下，桌面优先需要编写大量覆盖性样式，容易导致代码混乱。

## 3. 断点的选择

- **不要为特定设备设计断点**: 避免使用像 (width: 375px) 这样的断点来适配 iPhone。设备种类繁多，尺寸各异，这种做法无法扩展。
- **让内容决定断点**: 从小屏幕开始，逐渐拉宽你的浏览器窗口。当你的布局开始看起来不好看或崩坏时比如文字行太长、元素被过度挤压或拉伸就在那个临界点设置一个断点，并编写 CSS 来修复它。
- **使用 em 作为断点单位**: 推荐使用 em 而不是 px 来定义断点。这是因为 em 相对于字体大小，如果用户在浏览器中缩放了默认字体，使用 em 的断点能随之响应，而 px 则不会，这有助于保持布局在用户缩放下的可用性。

`css
/* 768px / 16px (默认字体大小) = 48em */
@media (min-width: 48em) {
  /* ... */
}
`

---
**下一章**: **[构建流式布局](fluid-layouts.md)**
