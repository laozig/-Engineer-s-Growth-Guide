# 层叠、特异性与继承

当多个CSS规则应用于同一个元素时，浏览器如何决定最终应用哪个样式？这由三个核心概念决定：层叠（Cascade）、特异性（Specificity）和继承（Inheritance）。

## 1. 层叠 (The Cascade)

层叠是CSS工作方式的基础。它是一个算法，用于解决多个CSS规则之间的冲突。浏览器会按以下顺序来考虑规则的权重，权重高的胜出：

1.  **来源与重要性 (Origin and Importance)**:
    - **过渡样式 (Transition)**: 应用在过渡效果中的样式具有最高优先级。
    - **!important 用户代理样式**: 浏览器内置的、被用户标记为 !important 的样式。
    - **!important 用户样式**: 用户通过浏览器插件等方式自定义的、标记为 !important 的样式。
    - **!important 作者样式**: 开发者在CSS文件中写的、标记为 !important 的样式。
    - **动画样式 (Animation)**: 应用在 @keyframes 中的样式。
    - **普通作者样式**: 开发者写的普通CSS规则。
    - **普通用户样式**: 用户自定义的普通样式。
    - **普通用户代理样式**: 浏览器的默认样式。

2.  **特异性 (Specificity)**: 如果来源和重要性相同，则比较选择器的特异性。特异性越高的规则胜出。

3.  **源顺序 (Source Order)**: 如果特异性也相同，则后出现的规则胜出。即在CSS文件中，写在后面的规则会覆盖前面的规则。

**!important 的使用**:
应极力避免使用 !important。它会打破自然的层叠规则，使得CSS难以调试和维护。只有在少数特殊情况下，如需要覆盖第三方库的内联样式时，才可考虑使用。

## 2. 特异性 (Specificity)

特异性是衡量一个选择器有多具体的数值。浏览器通过计算选择器的特异性来决定哪个样式规则胜出。

可以将特异性看作一个由四个部分组成的数值 (a, b, c, d)：

- **a (内联样式)**: 如果样式是写在元素的 style 属性中，则 a=1，否则为0。
- **b (ID选择器)**: 选择器中 ID选择器 (#id) 的数量。
- **c (类、属性和伪类选择器)**: 选择器中类选择器 (.class)、属性选择器 ([type="text"]) 和伪类 (:hover) 的数量。
- **d (类型和伪元素选择器)**: 选择器中类型选择器 (div) 和伪元素 (::before) 的数量。

**比较规则**:
从左到右依次比较 , b, c, d。第一个不为零且数值更大的选择器胜出。例如，(0,1,0,0) 的特异性高于 (0,0,10,0)。

**示例**:

| 选择器 | 特异性计算 | 结果 |
| :--- | :--- | :--- |
| p | d=1 | (0,0,0,1) |
| .content | c=1 | (0,0,1,0) |
| #header | b=1 | (0,1,0,0) |
| div.content | c=1, d=1 | (0,0,1,1) |
| #nav ul li a:hover | b=1, c=2, d=3 | (0,1,2,3) |
| style="..." | a=1 | (1,0,0,0) |

**特殊情况**:
- 通用选择器 * 和组合器 (>, +, ~) 不增加特异性。
- :is(), :not(): :not 伪类本身不增加特异性，但其参数会。:is 的特异性由其参数中特异性最高的选择器决定。
- :where(): 特异性始终为0。

## 3. 继承 (Inheritance)

继承是指某些CSS属性会自动从父元素传递到子元素。

- **可继承属性**: 通常是与文本相关的属性，如 color, ont-family, ont-size, line-height, 	ext-align 等。
- **不可继承属性**: 通常是与盒子模型相关的属性，如 width, height, padding, margin, order, ackground 等。

**显式控制继承**:
我们可以使用以下三个通用关键字来控制任何属性的继承行为：

- **inherit**: 强制继承父元素的属性值。
- **initial**: 将属性重置为浏览器定义的初始默认值。
- **unset**: 如果属性是可继承的，则行为同 inherit；如果属性是不可继承的，则行为同 initial。

**示例**:
`css
/* 让所有元素的盒子模型边框和内边距都继承父元素 */
.all-children-inherit-box-sizing {
  box-sizing: border-box;
}
.all-children-inherit-box-sizing * {
  box-sizing: inherit;
}

/* 强制 a 标签继承父元素的颜色 */
a {
  color: inherit;
}
`

理解这三个概念是调试和编写可预测、可维护CSS代码的关键。

---
**下一章**: **[常用CSS单位详解](css-units.md)**
