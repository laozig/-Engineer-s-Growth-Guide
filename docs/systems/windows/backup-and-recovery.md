# 16. 备份与恢复

数据丢失是任何系统管理员的噩梦。无论是由于硬件故障、软件错误、恶意软件攻击还是人为失误，拥有一个健全的备份和恢复策略都是至关重要的。Windows Server 提供了强大的内置工具来保护你的系统和数据。

---

### 16.1 Windows Server Backup 简介

Windows Server Backup (WSB) 是一个功能集，提供了备份和恢复 Windows Server 环境所需的基本功能。

**主要特点**:
-   **卷级备份**: WSB 在块级别工作，可以备份整个卷。这使得备份非常高效。
-   **系统状态备份 (System State Backup)**: 备份关键的操作系统组件，包括注册表、启动文件、Active Directory 数据库 (在域控制器上) 等。这是恢复域控制器或修复操作系统损坏所必需的。
-   **裸机恢复 (Bare Metal Recovery)**: 备份恢复整个服务器所需的所有卷，包括系统卷和关键数据。如果服务器硬件完全损坏，你可以使用它将整个系统恢复到新的硬件上。
-   **文件/文件夹恢复**: 你可以从卷备份中恢复单个文件或文件夹。
-   **应用程序感知**: WSB 能够与支持 VSS (Volume Shadow Copy Service) 的应用程序（如 SQL Server, Exchange）集成，以创建应用程序一致性的备份。

---

### 16.2 安装 Windows Server Backup

默认情况下，WSB 并未安装。

1.  打开 **服务器管理器** -> `添加角色和功能`。
2.  跳到 **功能** 页面。
3.  找到并勾选 `Windows Server Backup`。
4.  完成安装。

安装完成后，你可以在 `服务器管理器` -> `工具` -> `Windows Server Backup` 中找到它。

---

### 16.3 创建备份计划

最常见的做法是创建一个计划任务，定期自动执行备份。

1.  打开 **Windows Server Backup**。
2.  在右侧操作窗格中，点击 `备份计划...` 启动向导。
3.  **备份配置**:
    -   `整个服务器`: 推荐用于裸机恢复。它会备份所有卷。
    -   `自定义`: 允许你选择特定的卷、文件或系统状态。如果你只想备份 Active Directory，可以选择 `系统状态`。
4.  **指定备份时间**:
    -   选择 `一天一次` 或 `一天多次`，并设置具体时间。
5.  **指定目标类型**:
    -   **备份到硬盘**: **推荐方式**。你可以指定一个专门用于备份的**外部硬盘**或内部硬盘。
        -   **警告**: 当你选择一个硬盘作为备份目标时，WSB 会**格式化该硬盘**，并将其专用于备份。你将无法在文件资源管理器中看到它。
    -   **备份到卷**: 将备份保存到服务器上的某个卷。不推荐，因为备份和源数据在同一个物理硬盘上。
    -   **备份到网络共享文件夹**: 将备份保存到网络上的一个共享位置 (NAS, File Server)。
        -   **限制**: 每次备份都会**覆盖**前一次的备份。你无法保留多个版本的备份。

6.  **选择目标磁盘**: 如果上一步选择了硬盘，这里会列出可用的磁盘。
7.  确认并完成向导。

---

### 16.4 执行手动备份

除了计划备份，你也可以随时执行一次性备份。

1.  打开 **Windows Server Backup**。
2.  在右侧操作窗格中，点击 `备份一次...`。
3.  向导会询问你是使用与计划任务相同的选项，还是创建不同的选项。
4.  按照与创建备份计划类似的步骤完成即可。

---

### 16.5 恢复操作

当灾难发生时，你需要执行恢复。

1.  打开 **Windows Server Backup**。
2.  在右侧操作窗格中，点击 `恢复...`。
3.  **选择备份位置**:
    -   `此服务器`: 如果备份存储在本地连接的驱动器上。
    -   `另一台服务器`: 如果备份存储在网络共享中。
4.  **选择备份日期**: 从日历中选择一个可用的备份时间点。
5.  **选择恢复类型**:
    -   **文件和文件夹**: 用于恢复单个或多个文件/文件夹。
    -   **卷**: 将整个卷恢复到某个时间点。
    -   **系统状态**: 用于恢复 Active Directory、注册表等。这通常在目录服务还原模式 (DSRM) 下执行。
    -   **裸机恢复**: 这是最极端的场景。你需要使用 Windows Server 安装介质启动服务器，选择 `修复计算机` -> `系统映像恢复`，然后指向你的备份位置。

---

### 16.6 最佳实践

-   **3-2-1 规则**: 至少保留 **3** 份数据副本，存储在 **2** 种不同的介质上，其中 **1** 份是异地备份。
-   **使用专用备份盘**: 不要将备份与常规数据存储在同一个磁盘上。
-   **定期测试恢复**: 备份是否成功，只有在你成功恢复它之后才能确定。定期进行恢复演练。
-   **监控备份作业**: 定期检查 WSB 控制台或配置邮件通知，确保备份作业成功完成。
-   **结合云备份**: 对于关键数据，考虑使用 Azure Backup 或其他第三方云备份服务作为异地备份方案。 