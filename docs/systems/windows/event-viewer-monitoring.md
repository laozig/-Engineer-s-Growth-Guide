# 17. 事件查看器与性能监控

主动监控是优秀系统管理的标志。在问题升级为重大故障之前发现并解决它们，可以节省大量的时间和资源。Windows 提供了两个核心工具来实现这一目标：事件查看器 (Event Viewer) 和性能监视器 (Performance Monitor)。

---

### 17.1 事件查看器 (Event Viewer)

事件查看器是 Windows 中用于查看日志消息的中央控制台。几乎系统中的所有组件和应用程序都会在此记录其行为。

**打开方式**:
-   `eventvwr.msc`
-   `服务器管理器` -> `工具` -> `事件查看器`

**核心日志类别**:
-   **应用程序 (Application)**: 由应用程序或程序记录的事件。例如，数据库程序可能会在此记录文件错误。
-   **安全 (Security)**: 这些事件被称为"审核"。例如，成功和失败的登录尝试。你需要通过组策略配置要审核哪些内容。
-   **安装 (Setup)**: 与应用程序安装相关的事件。
-   **系统 (System)**: 由 Windows 系统组件记录的事件。例如，驱动程序加载失败或服务启动失败。
-   **转发事件 (Forwarded Events)**: 从其他计算机收集的事件。

**事件级别**:
-   **错误 (Error)**: 表示严重问题，可能导致功能丧失。
-   **警告 (Warning)**: 表示一个潜在问题，不一定很严重，但值得关注。
-   **信息 (Information)**: 描述程序或服务的成功操作。这是最常见的事件类型。

**如何使用事件查看器进行故障排除**:
1.  **确定问题时间**: 当用户报告问题时，首先询问问题发生的大致时间。
2.  **检查相关日志**:
    -   如果是应用程序崩溃，请检查**应用程序**日志。
    -   如果是登录问题，请检查**安全**日志。
    -   如果是系统蓝屏或启动问题，请检查**系统**日志。
3.  **筛选日志**: 日志文件可能非常庞大。使用右侧操作窗格中的 `筛选当前日志...` 功能。你可以按**事件级别** (例如，只看"错误"和"警告")、**时间**、**事件 ID** 或**来源**进行筛选。
4.  **查找事件 ID**: 当你找到一个可疑的错误事件时，记下它的 **事件 ID**。将这个 ID 和来源复制到搜索引擎中，通常可以找到关于此问题的详细解释和解决方案。

---

### 17.2 性能监视器 (Performance Monitor)

性能监视器 (`perfmon.msc`) 是一个强大的工具，用于实时监控、收集和分析有关硬件、服务和应用程序性能的详细数据。

**核心组件**:
-   **性能监视器 (Performance Monitor)**: 提供一个实时的图表，显示你选择的性能计数器的值。
-   **数据收集器集 (Data Collector Sets)**: 这是 `perfmon` 最有用的部分。你可以创建自定义的集合，将性能计数器数据、事件跟踪数据和系统配置信息记录到日志文件中，以便稍后进行分析。
-   **报告 (Reports)**: 查看由数据收集器集生成的报告。

**关键性能计数器**:
当你怀疑系统存在性能瓶颈时，以下计数器是很好的起点：

-   **处理器 (Processor) -> `% Processor Time`**:
    -   **对象**: `Processor` (对于总计) 或 `Process` (对于单个进程)。
    -   **描述**: CPU 的使用率。如果这个值持续高于 80-90%，说明 CPU 可能是瓶颈。
-   **内存 (Memory) -> `Available MBytes`**:
    -   **描述**: 系统中可用的物理内存量。如果这个值非常低，说明系统可能存在内存压力。
-   **物理磁盘 (PhysicalDisk) -> `Avg. Disk sec/Transfer`**:
    -   **描述**: 完成一次磁盘 I/O 操作所需的平均时间（秒）。这是衡量磁盘延迟的关键指标。
    -   **阈值**:
        -   `< 0.010` (10ms): 良好
        -   `0.010 - 0.025` (10-25ms): 可接受
        -   `> 0.025` (25ms): 较差，磁盘可能是瓶颈。
-   **物理磁盘 (PhysicalDisk) -> `Disk Transfers/sec`**:
    -   **描述**: 磁盘的 I/O 操作速率 (IOPS)。它的可接受范围取决于你的磁盘类型（HDD vs SSD）。
-   **网络接口 (Network Interface) -> `Bytes Total/sec`**:
    -   **描述**: 网络适配器发送和接收数据的速率。将此值与你的网络带宽进行比较，可以判断网络是否饱和。

**如何使用数据收集器集进行长期监控**:
1.  打开 `性能监视器`。
2.  展开 `数据收集器集` -> `用户定义`。
3.  右键 -> `新建` -> `数据收集器集`。
4.  输入一个名称，选择 `从模板创建(推荐)`。
5.  选择模板，`系统性能` 是一个很好的通用起点。
6.  指定日志文件的保存位置。
7.  完成向导。该数据收集器集默认会运行 60 秒。
8.  你可以右键点击新创建的集，查看其**属性**，修改其中的性能计数器、运行计划（例如，每天的特定时间运行）和停止条件。
9.  启动该数据收集器集，让它在后台收集数据。收集完成后，你可以在 `报告` 部分找到对应的报告进行分析。

通过结合使用事件查看器和性能监视器，你可以全面了解 Windows 服务器的健康状况和性能表现，从而实现主动式系统管理。 