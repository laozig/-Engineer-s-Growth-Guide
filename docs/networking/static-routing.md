# 9. 静态路由

路由是网络的核心功能，它决定了数据包如何从一个网络穿越到另一个网络。实现路由的方式主要有两种：静态路由和动态路由。静态路由是最基本、最直接的路由方式，需要网络管理员手动配置。

---

### 9.1 什么是静态路由？

静态路由是一条由网络管理员手动创建和维护的路由条目。它明确地告诉路由器："要想到达目标网络 X，请将数据包从接口 Y 发送出去，或者发送给下一跳地址 Z。"

**静态路由的特点**:
-   **手动配置**: 管理员必须在每一台需要进行路由的路由器上配置每一条路由。
-   **固定不变**: 除非管理员手动修改或删除，否则静态路由条目永远不会改变。它不会根据网络拓扑的变化（如链路中断）自动调整。
-   **管理开销**: 在大型、动态变化的网络中，维护静态路由的工作量巨大且容易出错。
-   **低资源消耗**: 路由器不需要运行复杂的路由协议，不占用 CPU 和内存资源来计算和交换路由更新。
-   **高安全性**: 由于路由信息不会在网络中传播，因此更加安全，不会泄露网络拓扑信息。

---

### 9.2 何时使用静态路由？

尽管动态路由在大型网络中更为常见，但静态路由在许多场景下仍然非常有用，甚至是首选：

1.  **末梢网络 (Stub Network)**:
    -   一个末梢网络是指只有一个出口的网络。对于这个网络中的路由器（称为末梢路由器），它通往外界的路径是唯一的。为其配置一条指向该出口的**默认路由**是最高效的做法。

2.  **小型网络**:
    -   在网络拓扑简单且固定不变的小型网络中（例如，只有两三台路由器），使用静态路由进行管理比配置和维护动态路由协议更简单、更直接。

3.  **特定路径控制**:
    -   管理员可以利用静态路由来强制数据包走一条特定的路径，即使动态路由协议可能会选择另一条路径。这对于实现特定的网络策略非常有用。

4.  **作为动态路由的备份**:
    -   可以配置一条"浮动静态路由"，其管理距离（Administrative Distance）比动态路由协议更高。正常情况下，动态路由生效；当动态路由丢失时（例如链路故障），这条浮动静态路由就会自动出现在路由表中，作为备用路径。

---

### 9.3 如何配置静态路由

在思科 IOS 中，配置静态路由的命令格式如下：
```bash
Router(config)# ip route <destination-network> <subnet-mask> <next-hop-address | exit-interface> [administrative-distance]
```

-   `<destination-network>`: 目标网络的网络地址。
-   `<subnet-mask>`: 目标网络的子网掩码。
-   `<next-hop-address | exit-interface>`: 指定如何到达目标网络。
    -   `next-hop-address`: 指定下一跳路由器的 IP 地址。这是**推荐**的方式，尤其是在多路访问网络（如以太网）中。
    -   `exit-interface`: 指定本地路由器的出站接口。通常用于点对点串行链路。
-   `[administrative-distance]`: (可选) 管理距离，用于配置浮动静态路由。

**配置示例**:
假设 R1 要到达 R2 后面的网络 `192.168.2.0/24`，R2 连接 R1 的接口 IP 是 `10.1.1.2`。
```bash
R1(config)# ip route 192.168.2.0 255.255.255.0 10.1.1.2
```

---

### 9.4 默认路由 (Default Route)

默认路由是一种特殊的静态路由，它告诉路由器："对于任何在路由表中找不到明确匹配条目的目标网络，都将数据包发送到这里。" 它通常被称为"最后选择的网关 (Gateway of Last Resort)"。

默认路由的目标网络和掩码都是 `0.0.0.0`。

**配置示例**:
假设 R1 的出口是ISP，下一跳地址是 `203.0.113.1`。
```bash
R1(config)# ip route 0.0.0.0 0.0.0.0 203.0.113.1
```
配置后，R1 就有了通往互联网上所有未知网络的路径。

**验证路由**:
```bash
# 查看路由表
show ip route

# 查看静态路由配置
show ip route static

# 查看默认路由是否被设置
show ip route | include 0.0.0.0
```
在路由表中，静态路由以 `S` 标记，默认路由以 `S*` 标记。

---

### 9.5 浮动静态路由

浮动静态路由是一条管理距离 (AD) 大于主路径的备份路由。

-   **管理距离 (AD)**: 是路由器用来衡量路由来源可信度的值（0-255），**数值越小越可信**。
    -   直连网络: 0
    -   静态路由: 1
    -   EIGRP: 90
    -   OSPF: 110
    -   RIP: 120

**配置示例**:
假设主路径是通过 OSPF (AD=110) 学习的，我们配置一条 AD 为 111 的浮动静态路由作为备份。
```bash
Router(config)# ip route 192.168.2.0 255.255.255.0 10.1.1.10 111
```
只要 OSPF 路由存在，这条静态路由就不会出现在路由表中。一旦 OSPF 路由消失，它就会立即生效。 