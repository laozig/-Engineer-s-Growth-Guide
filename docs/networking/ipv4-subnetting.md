# 2. IP 地址与子网划分 (IPv4 & Subnetting)

IP 地址是网络世界中的"门牌号码"，它使得数据包能够准确地找到其目的地。在 IPv4 中，地址资源是有限的，因此理解地址结构和如何通过子网划分（Subnetting）来高效地使用地址至关重要。

---

### 2.1 IPv4 地址结构

一个 IPv4 地址是一个 32 位的二进制数。为了方便人类阅读，它通常被写成四个由点分隔的十进制数（点分十进制表示法），每个数代表 8 位（一个字节）。

-   **示例**: `192.168.1.1`
-   **二进制形式**: `11000000.10101000.00000001.00000001`

一个 IP 地址包含两部分信息：
1.  **网络部分 (Network ID)**: 标识设备所在的网络。同一网络中的所有设备必须有相同的网络 ID。
2.  **主机部分 (Host ID)**: 标识网络中的特定设备。同一网络中的主机 ID 必须是唯一的。

---

### 2.2 子网掩码 (Subnet Mask)

我们如何知道 IP 地址的哪部分是网络 ID，哪部分是主机 ID？答案是**子网掩码**。

子网掩码也是一个 32 位的二进制数，其中：
-   二进制 `1` 对应的位置表示 IP 地址的网络部分。
-   二进制 `0` 对应的位置表示 IP 地址的主机部分。

**示例**:
-   **IP 地址**: `192.168.1.10`
-   **子网掩码**: `255.255.255.0`
-   **子网掩码 (二进制)**: `11111111.11111111.11111111.00000000`

将 IP 地址和子网掩码进行**按位与 (AND)** 运算，就可以得到网络地址：
```
  11000000.10101000.00000001.00001010  (192.168.1.10)
& 11111111.11111111.11111111.00000000  (255.255.255.0)
-----------------------------------------
  11000000.10101000.00000001.00000000  (192.168.1.0) -> 这是网络地址
```
在这个例子中，前 24 位是网络部分，后 8 位是主机部分。

**CIDR 表示法 (Classless Inter-Domain Routing)**:
这是一种更简洁的表示子网掩码的方式，直接在 IP 地址后面加上 `/` 和网络部分的位数。
-   `255.255.255.0` 等价于 `/24`
-   `255.255.0.0` 等价于 `/16`
-   所以，`192.168.1.10` 和 `255.255.255.0` 可以简写为 `192.168.1.10/24`。

---

### 2.3 为什么要进行子网划分？

子网划分是将一个大的网络块分割成多个更小的网络（子网）的过程。主要有以下几个原因：

1.  **提高地址使用效率**: 如果一个部门只需要 20 个 IP 地址，分配一个拥有 254 个地址的 C 类网络会造成巨大浪费。通过子网划分，可以将这个大网络切分成多个小网络，按需分配。
2.  **增强网络安全**: 不同子网之间的数据传输需要经过路由器。我们可以在路由器上设置访问控制列表（ACL），限制不同子网间的访问。
3.  **减少网络拥堵**: 将设备划分到不同的子网可以隔离广播流量。一个子网内的广播包不会被路由器转发到其他子网，从而减少了不必要的网络流量，提高了整体性能。

---

### 2.4 如何进行子网划分

子网划分的核心思想是：**从主机部分借用几位来创建子网部分**。

**示例：将网络 `192.168.1.0/24` 划分成多个子网**

假设我们需要至少 4 个子网。

1.  **确定需要借多少位**:
    -   公式: `2^n >= 需要的子网数` (n 是需要借用的位数)
    -   `2^2 = 4`，所以我们需要从主机部分借用 **2** 位。

2.  **计算新的子网掩码**:
    -   原始掩码是 `/24`。
    -   借用 2 位后，新的掩码是 `/26` (`24 + 2`)。
    -   新的子网掩码是 `255.255.255.192` (二进制 `11111111.11111111.11111111.11000000`)。

3.  **确定每个子网的属性**:
    -   我们借用了 2 位，这两位可以产生 `00`, `01`, `10`, `11` 四种组合，对应四个子网。
    -   主机位还剩下 `8 - 2 = 6` 位。
    -   每个子网的主机数是 `2^6 - 2 = 62` 个。(减 2 是因为全 0 的地址是网络地址，全 1 的是广播地址，都不能分配给主机)。
    -   块大小 (Magic Number) = `256 - 192 = 64`。这表示每个子网的地址范围是 64 个。

4.  **列出子网**:

| 子网号 | 网络地址 | 可用 IP 范围 | 广播地址 |
| :--- | :--- | :--- | :--- |
| **1** | `192.168.1.0/26` | `192.168.1.1` - `192.168.1.62` | `192.168.1.63` |
| **2** | `192.168.1.64/26` | `192.168.1.65` - `192.168.1.126`| `192.168.1.127`|
| **3** | `192.168.1.128/26`| `192.168.1.129`- `192.168.1.190`| `192.168.1.191`|
| **4** | `192.168.1.192/26`| `192.168.1.193`- `192.168.1.254`| `192.168.1.255`|

通过这个过程，我们成功地将一个 `/24` 的网络划分成了四个 `/26` 的子网，每个子网可以容纳 62 台主机，从而实现了对 IP 地址的精细化管理。 