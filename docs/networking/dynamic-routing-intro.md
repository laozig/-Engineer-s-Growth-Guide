# 10. 动态路由协议入门

虽然静态路由在特定场景下很有用，但它无法适应网络拓扑的变化。在任何规模稍大的网络中，手动维护路由表都变得不切实际。这时，动态路由协议就派上了用场。它们允许路由器之间自动地交换和学习路由信息，从而动态地构建和维护路由表。

---

### 10.1 为什么需要动态路由？

-   **自动化**: 无需手动配置每一条路由。路由器会自动发现邻居并学习整个网络的拓扑。
-   **可扩展性**: 在大型网络中添加或移除路由器和网络时，动态路由协议可以自动适应这些变化，无需管理员干预所有路由器。
-   **故障恢复**: 当一条链路或一台路由器发生故障时，动态路由协议能够检测到这种变化，并自动计算出替代路径，从而实现网络自愈。

---

### 10.2 动态路由协议的分类

动态路由协议可以根据其工作范围和算法进行分类。

**按作用域分类 (AS - 自治系统)**:
一个自治系统（Autonomous System, AS）是指在一个单一技术管理域内的路由器集合。通俗地讲，就是一个组织（如一个公司、一个大学、一个ISP）所管理的网络。

1.  **内部网关协议 (Interior Gateway Protocol, IGP)**:
    -   在一个**自治系统内部**运行的路由协议。
    -   主要目标是快速、高效地找到 AS 内部的最佳路径。
    -   常见的 IGP 协议包括：**RIP, EIGRP, OSPF**。

2.  **外部网关协议 (Exterior Gateway Protocol, EGP)**:
    -   在**不同自治系统之间**运行的路由协议。
    -   其主要目标不是寻找最快的路径，而是根据各种策略（如政治、经济、安全策略）来选择最佳路径。
    -   目前互联网上使用的**唯一**的 EGP 协议是 **BGP (Border Gateway Protocol)**。

---

### 10.3 按算法分类

1.  **距离矢量协议 (Distance Vector)**:
    -   **工作方式**: 这种协议的路由器并不了解整个网络的拓扑。它们只知道到目标网络的"距离"（通常是跳数）和应该走的方向（"矢量"，即下一跳路由器）。它们依赖于邻居路由器传递过来的路由信息，这种方式有时被称为"基于传闻的路由 (routing by rumor)"。
    -   **路由更新**: 定期地将自己的**整个路由表**发送给所有邻居。
    -   **收敛速度**: 较慢。
    -   **环路问题**: 容易产生路由环路，需要依赖水平分割（Split Horizon）、路由毒化（Route Poisoning）等机制来防止。
    -   **协议示例**: **RIP**, **EIGRP** (EIGRP 是一个高级距离矢量协议，也称为混合型协议)。

2.  **链路状态协议 (Link-State)**:
    -   **工作方式**: 这种协议的路由器致力于构建整个网络的**完整拓扑图**。每台路由器都会收集关于其直连接口（链路）和邻居的信息，并将其泛洪（flooding）到整个网络。最终，网络中的每台路由器都会拥有一张相同的"网络地图"。
    -   有了完整的地图后，每台路由器都会独立地使用 **SPF (Shortest Path First) 算法**（也称 Dijkstra 算法）来计算出自己到所有其他网络的最佳路径。
    -   **路由更新**: 只在网络拓扑发生变化时才发送更新。更新中只包含变化了的链路状态信息，而不是整个路由表。
    -   **收敛速度**: 非常快。
    -   **资源消耗**: 相较于距离矢量协议，需要更多的 CPU 和内存来维护拓扑数据库和运行 SPF 算法。
    -   **协议示例**: **OSPF**, **IS-IS**。

---

### 10.4 关键概念对比

| 特性 | 距离矢量 (Distance Vector) | 链路状态 (Link-State) |
| :--- | :--- | :--- |
| **网络视野** | 只了解邻居告诉它的信息 | 拥有整个网络的完整拓扑图 |
| **核心算法** | Bellman-Ford (或类似算法) | Dijkstra (SPF 算法) |
| **路由更新** | 定期发送整个路由表 | 仅在变化时发送链路状态更新 |
| **收敛速度** | 慢 | 快 |
| **资源消耗** | 较低 | 较高 |
| **代表协议** | RIP, IGRP, EIGRP (高级) | OSPF, IS-IS |

---

### 10.5 管理距离 (Administrative Distance, AD)

当一台路由器从多个不同的路由协议（或静态路由）学习到关于同一个目标网络的多条路径时，它如何决定哪条路径是最好的？答案就是**管理距离**。

AD 是一个 0 到 255 之间的整数，代表了路由来源的**可信度**。**AD 值越小，可信度越高**。

**常见协议的默认 AD 值**:
| 路由来源 | 默认 AD 值 |
| :--- | :--- |
| 直连网络 (Connected) | 0 |
| 静态路由 (Static) | 1 |
| EIGRP (内部) | 90 |
| OSPF | 110 |
| RIP | 120 |
| EIGRP (外部) | 170 |
| 未知来源 | 255 (不可信) |

**示例**: 如果一台路由器同时从 OSPF (AD=110) 和 RIP (AD=120) 得知了去往网络 A 的路径，它会选择 OSPF 的路径并将其放入路由表，因为 OSPF 的 AD 值更小。 