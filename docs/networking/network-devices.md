# 4. 常用网络设备

网络是由各种专门的硬件设备连接起来的，这些设备在 OSI 模型或 TCP/IP 模型中的不同层次上工作，共同确保数据能够从源头正确地传输到目的地。

---

### 4.1 Hub (集线器) - OSI 第 1 层

-   **工作原理**: 集线器是一个非常简单的网络设备，它在物理层（OSI 第 1 层）上运行。当一个数据包（实际上是电信号）到达集线器的一个端口时，集线器会不加分辨地将这个信号**复制并广播**到所有其他端口。
-   **冲突域 (Collision Domain)**: 连接到同一个集线器的所有设备共享同一个冲突域。这意味着如果两台设备同时发送数据，就会发生冲突，导致数据损坏。设备越多，冲突的可能性就越大。
-   **半双工 (Half-Duplex)**: 由于存在冲突的风险，连接到集线器的设备通常以半双工模式工作，即在同一时间只能发送或接收数据，不能同时进行。
-   **现代应用**: 由于其低效和性能问题，集-线器在现代网络中**已基本被淘汰**，被交换机所取代。

---

### 4.2 Switch (交换机) - OSI 第 2 层

-   **工作原理**: 交换机在数据链路层（OSI 第 2 层）上工作，比集线器智能得多。它内部维护着一张 **MAC 地址表**，这张表记录了每个端口连接的设备的 MAC 地址。
-   当一个数据帧到达交换机时，交换机会检查该帧的目标 MAC 地址，然后只将该帧从连接着目标设备的**特定端口**转发出去，而不是广播到所有端口。如果目标 MAC 地址未知，交换机才会进行广播以找到它。
-   **冲突域**: 交换机的每个端口都是一个独立的冲突域。这意味着连接到不同端口的设备可以同时发送数据而不会发生冲突。
-   **全双工 (Full-Duplex)**: 由于每个端口是独立的冲突域，设备可以全双工模式工作，即同时发送和接收数据。
-   **现代应用**: 交换机是现代局域网（LAN）的**核心组件**，用于连接计算机、服务器、打印机等终端设备。

---

### 4.3 Router (路由器) - OSI 第 3 层

-   **工作原理**: 路由器在网络层（OSI 第 3 层）上工作。它的主要功能是在不同的网络之间转发数据包。交换机使用 MAC 地址在局域网内转发数据，而路由器使用 **IP 地址**在广域网（如互联网）上转发数据。
-   路由器内部维护着一张**路由表**，这张表包含了到达不同目标网络的路径信息。当路由器收到一个数据包时，它会检查数据包的目标 IP 地址，并根据路由表选择最佳路径将其转发出去。
-   **广播域 (Broadcast Domain)**: 路由器的每个接口都连接着一个不同的网络，并且是独立的广播域。路由器**不会转发广播包**，这有助于隔离广播流量，防止网络风暴。
-   **功能**: 除了基本的路由功能，现代路由器通常还提供 DHCP（动态分配IP地址）、NAT（网络地址转换）和防火墙等功能。
-   **现代应用**: 路由器是连接不同局域网或将局域网连接到互联网的**关键设备**。

---

### 4.4 Firewall (防火墙)

-   **工作原理**: 防火墙是一种网络安全设备，其主要目的是监控和控制进出网络的流量。它根据预先定义好的安全规则来允许或拒绝数据包通过。
-   **工作层次**: 防火墙可以在 OSI 模型的多个层次上工作：
    -   **包过滤防火墙**: 主要工作在第 3 层和第 4 层，根据源/目的 IP 地址、端口号和协议类型来做决定。
    -   **状态检测防火墙**: 跟踪活动连接的状态，并根据连接状态做出更智能的决策。
    -   **应用层防火墙 (代理防火墙/WAF)**: 工作在第 7 层，能够理解特定应用程序的协议（如 HTTP），并对内容进行深度检查，以防止更复杂的攻击。
-   **部署位置**: 防火墙通常部署在内部私有网络和外部公共网络（如互联网）的边界上，作为第一道防线。

### 总结对比

| 设备 | OSI 工作层次 | 主要功能 | 寻址方式 | 冲突域/广播域 |
| :--- | :--- | :--- | :--- | :--- |
| **Hub** | 1 (物理层) | 复制并广播信号 | 无 | 所有端口在同一冲突域 |
| **Switch** | 2 (数据链路层) | 智能转发数据帧 | MAC 地址 | 每个端口是独立冲突域 |
| **Router** | 3 (网络层) | 在不同网络间路由数据包 | IP 地址 | 每个接口是独立广播域 |
| **Firewall**| 3/4/7 等 | 根据安全规则过滤流量 | IP 地址, 端口等 | - | 