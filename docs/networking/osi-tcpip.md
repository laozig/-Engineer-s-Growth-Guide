# 1. 网络模型与协议 (OSI & TCP/IP)

为了让全球不同厂商生产的计算机和网络设备能够相互通信，国际标准化组织（ISO）和其他组织制定了标准的网络模型。这些模型将极其复杂的网络通信过程划分为一系列功能上不同的层次。其中，OSI 模型和 TCP/IP 模型是两个最重要、最广为人知的参考模型。

---

### 1.1 OSI 参考模型 (Open Systems Interconnection)

OSI 模型是一个理论上的七层模型，它为网络协议的设计提供了一个清晰的框架。虽然现代互联网主要基于 TCP/IP 模型，但 OSI 模型的概念和术语在网络教学和故障排除中仍被广泛使用。

**OSI 七层模型**:

| 层级 | 名称 | 功能描述 | 常见协议/设备 |
| :--- | :--- | :--- | :--- |
| **7** | **应用层 (Application)** | 为应用程序提供网络服务，是用户与网络的接口。 | HTTP, FTP, SMTP, DNS |
| **6** | **表示层 (Presentation)** | 处理数据格式、数据加密和数据压缩，确保不同系统间的数据可读。 | SSL, TLS, JPEG, ASCII |
| **5** | **会话层 (Session)** | 建立、管理和终止两个通信主机之间的会话或连接。 | NetBIOS, RPC |
| **4** | **传输层 (Transport)** | 提供端到端的数据传输服务，负责数据分段、流量控制和错误校验。 | **TCP**, **UDP** |
| **3** | **网络层 (Network)** | 负责逻辑寻址（IP地址）和路由选择，将数据包从源头传送到目的地。 | **IP**, ICMP, OSPF |
| **2** | **数据链路层 (Data Link)**| 负责物理寻址（MAC地址），在物理链路上提供可靠的数据传输。 | Ethernet, PPP, HDLC |
| **1** | **物理层 (Physical)** | 负责传输原始的比特流，定义了电压、接口、线缆等物理规范。 | 网线, 光纤, Hub |

**记忆技巧**:
- 从上到下: **A**ll **P**eople **S**eem **T**o **N**eed **D**ata **P**rocessing (所有人都似乎需要数据处理)
- 从下到上: **P**lease **D**o **N**ot **T**hrow **S**ausage **P**izza **A**way (请不要扔掉香肠披萨)

---

### 1.2 TCP/IP 模型

TCP/IP 模型是当前互联网事实上的标准。它比 OSI 模型更精简，通常被描述为一个四层或五层模型。

**TCP/IP 四层模型**:

| 层级 | 名称 | 对应 OSI 层 | 功能描述 |
| :--- | :--- | :--- | :--- |
| **4** | **应用层 (Application)** | 应用层, 表示层, 会话层 | 提供应用程序间的通信。 |
| **3** | **传输层 (Transport)** | 传输层 | 负责端到端的通信和流量控制。 |
| **2** | **网络层 (Internet)** | 网络层 | 负责数据包的路由和逻辑寻址。 |
| **1** | **网络接口层 (Network Interface)** | 数据链路层, 物理层 | 负责将 IP 数据报封装成帧并进行物理传输。 |

---

### 1.3 核心协议：TCP vs UDP

在传输层，TCP 和 UDP 是两个最核心的协议。

-   **TCP (Transmission Control Protocol - 传输控制协议)**
    -   **面向连接**: 在传输数据前，必须先建立连接（三次握手）。
    -   **可靠的**: 保证数据按顺序、无差错地到达。它通过序列号、确认（ACK）和重传机制来实现可靠性。
    -   **流量控制**: 使用滑动窗口机制来防止发送方压垮接收方。
    -   **开销大**: 由于需要维护连接状态和进行各种校验，其头部开销较大，速度相对较慢。
    -   **适用场景**: 对数据完整性要求高的应用，如网页浏览 (HTTP/HTTPS)、文件传输 (FTP)、电子邮件 (SMTP)。

-   **UDP (User Datagram Protocol - 用户数据报协议)**
    -   **无连接**: 发送数据前不需要建立连接。
    -   **不可靠的**: 不保证数据能否到达、是否按序、是否完整。它只是尽最大努力交付。
    -   **开销小**: 头部开销非常小（只有8字节），传输速度快。
    -   **适用场景**: 对实时性要求高、能容忍少量丢包的应用，如视频/音频流 (VoIP)、在线游戏、DNS 查询。

---

### 1.4 数据封装过程

数据从高层向低层传递时，每一层都会在前一层数据的基础上添加自己的头部信息（有时还有尾部），这个过程称为**封装 (Encapsulation)**。

1.  **应用层**: 用户数据 (Data)
2.  **传输层**: `[TCP/UDP头]` + 数据 = **段 (Segment)**
3.  **网络层**: `[IP头]` + 段 = **包 (Packet)**
4.  **数据链路层**: `[帧头]` + 包 + `[帧尾]` = **帧 (Frame)**
5.  **物理层**: 帧被转换为**比特流 (Bits)** 在介质上传输。

当数据到达目的地时，会执行一个相反的**解封装 (De-encapsulation)** 过程，从低层到高层逐层剥离头部信息，最终将原始数据交给应用程序。这个过程是理解网络通信和故障排查的基础。 